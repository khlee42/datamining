---
title: "Data Mining - Midterm Exam"
output: 
  learnr::tutorial: 
    toc: TRUE
    toc_float: FALSE
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(gradethis)
library(nycflights13)

set.seed(123)
# a larger # observations causes pandoc error on shinyapps.
flights <- flights %>% sample_n(1000)

knitr::opts_chunk$set(echo = FALSE)
```

# Instruction

- This console is provided only for the testing purpose. You can write and test your code before submitting your answer, but what you enter into the console won't be recorded nor submitted.
- **You must submit your answer to the below questions on Canvas.**
- You can navigate through the "previous topic" and "next topic" buttons on the bottom, or the question list on the left.
- Click the title if you don't see the question list.

## Data

This exam uses the nycflights13 data, which we are familiar with from HW1. The data is pre-loaded, so you don't need to load any packages. And the original data set is too large for the test purpose, so a sample of 1000 obs has been randomly chosen and we will be using this instead. Below is the description of the data.
```{r data_summary, exercise=TRUE, exercise.eval=TRUE}
glimpse(flights)
```

## Question 1

What is the flight number and carrier of the flight with the longest total delay (`total_delay` = `dep_delay` + `arr_delay`)?

1. AA 181
2. UA 488
3. DL 1091
4. MQ 4577

```{r q1, exercise=TRUE}

```

```{r q1-hint}
flights %>%
  .....(total_delay = dep_delay + arr_delay) %>% 
  .....(desc(total_delay)) %>% 
  select(flight, carrier, total_delay)
```

## Question 2

Which airline carrier has the longest average total delay?

1. AA
2. EV
3. MQ
4. UA

```{r q2, exercise=TRUE}

```

```{r q2-hint}
flights %>%
  .....(total_delay = dep_delay + arr_delay) %>% 
  .....(.....) %>% 
  .....(avg_total_delay = mean(total_delay, na.rm=TRUE)) %>% 
  arrange(desc(avg_total_delay))
```


## Question 3
The code below creates a bar plot of carriers and the number of flights by each carrier flying out of NYC in 2013.
```{r q3, exercise=TRUE}
ggplot(data = flights, aes(x = carrier)) +
  geom_bar() +
  coord_flip()
```

Which of the following changes to the code will order the bars in order of frequency?

1. Use `geom_col()` instead of `geom_bar()`.
2. Use `geom_bar(position = "fill")`.
3. Map `fct_count(carrier)` to x, instead of just `carrier`.
4. Map `fct_infreq(carrier)` to x, instead of just `carrier`. (correct)

## Question 4

What is the average `dep_delay` of the flights whose `arr_delay` is greater than 60?

1. 86.2341
2. 98.8872
3. 108.1512
4. 112.6526

```{r q4, exercise=TRUE}

```

```{r q4-hint}
flights %>%
  .....(.....) %>% 
  .....(avg_dep_delay = mean(dep_delay))
```

## Question 5

Which airline carrier is the most frequently departed from all three NYC airports?

1. B6
2. EV
3. UA
4. AA

```{r q5, exercise=TRUE}

```

```{r q5-hint}
flights %>% 
  .....(carrier) %>% 
  .....(desc(n))
```

## Question 6

Which airline carrier is the most frequently departed from the JFK airport?

1. B6
2. EV
3. UA
4. AA

```{r q6, exercise=TRUE}

```

```{r q6-hint}
flights %>% 
  .....(origin=="JFK") %>% 
  .....(carrier) %>% 
  .....(desc(n))
```


## Question 7

Which route (origin-destination) has the largest number of flights leaving New York City airports in 2013?

1. JFK - LAX
2. LGA - ATL
3. JFK - SFO
4. EWR - ORD

```{r q7, exercise=TRUE}

```

```{r q7-hint}
flights %>% 
  count(....., .....) %>% 
  .....(desc(n))
```


## Question 8

Define the average speed of flight as the flight distance divided by flight hour. Which rouhte has the fastest flight speed? 

1. EWR - LAX
2. JFK - HNL
3. LGA - IAH
4. JFK - SFO

```{r q8, exercise=TRUE}

```

```{r q8-hint}
flights %>% 
  .....(speed = ...../.....) %>% 
  .....(origin, dest) %>% 
  .....(mean_speed = mean(speed)) %>% 
  .....(desc(mean_speed))
```


## Question 9

Which destination has the lowest number of flights leaving New York City airports?

1. ATL
2. EGE
3. CHO
4. ALB

```{r q9, exercise=TRUE}

```

```{r q9-hint}
flights %>% 
  .....(dest) %>% 
  .....(n)
```

## Question 10

What is the name of the airport that has the highest number of flights leaving New York City airports in 2013?

1. Hartsfield Jackson Atlanta Intl
2. Orlando Intl
3. San Francisco Intl
4. Detroit Metro Wayne Co

For this question, you need another data frame named `airports` and join this with `flights` to get the correct answer.

```{r airports_data, exercise=TRUE, exercise.eval=TRUE}
glimpse(airports)
```

```{r q10, exercise=TRUE}

```

```{r q10-hint}
flights %>%
  .....(airports, by=c(..... = .....)) %>% 
  .....(dest, name, sort = TRUE)
```

