---
title: "Homework 1 - Data wrangling and visualization"
author: "Enter Your Name"
output: 
  html_document:
    theme: cosmo
    toc: TRUE
    toc_float: TRUE
    code_download: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Release: `r due_hw$release[1]`**  
**Due: `r due_hw$due[1]`**

In this homework, ...

Change the author name to yours


```{r warning=FALSE, message=FALSE}
library(tidyverse)
library(nycflights13)
```


# Question 1

- Q1-1. Remove the columns `year` from your data frame (`flights1`) [Hint: Reassign a data frame excluding the variables. You may want to use negative index]
```{r label='q1-1'}
flights %>%
  select(-year)
```

- Q1-2. Add a new variable, total_delay, which is the sum of `dep_delay` and `arr_delay`, to your data frame (`flights1`). Sort your data frame (`flights1`) in descending order of total_delay, and save it as a new data frame `flight2`
```{r label='q1-2'}
flights1 <- flights %>%
  mutate(total_delay = dep_delay + arr_delay) %>% 
  arrange(desc(total_delay))
```

- Q1-3. Draw box plots of total delay separately by carriers. Use `flights1`

```{r}
ggplot(flights1, aes(x=carrier, y=total_delay)) + 
  geom_boxplot()
```

# Question 2

- Q3-1. Filter flights whose `dep_delay` or `arr_delay` is greater than 60, and save it as a new data frame `major_delay`
```{r}
major_delay <- flights %>%
  filter(dep_delay > 60 | arr_delay > 60)
```

- Q3-2. Then, draw a pie chart to examine the most frequently delayed carrier.
```{r}
carrier_table <- major_delay %>%
  group_by(carrier) %>%
  summarize(count = n())

ggplot(carrier_table, aes(x="", y=count, fill = carrier)) +
  geom_col() + 
  coord_polar("y", start=0)
```

# Question 4
Among the flights with a major delay, defined above (`major_delay`),

- Q4-1. Filter flights that departed from JFK airport and save it as `JFK_flights` 
```{r}
JFK_flights <- major_delay %>%
  filter(origin=="JFK")
```

- Q4-2. Visualize the number of flights by destination, in decreasing order, that departed from JFK (Hint: sort function can be applied to various data types, such as data frame, vector, table)
```{r}
dest_table <- JFK_flights %>%
  group_by(dest) %>%
  mutate(count = n()) %>%
  arrange(desc(count))

ggplot(dest_table, aes(x=reorder(dest, -count), y=count)) + 
  geom_col()
```

- Q4-3. Create the histogram of total delay of flights that departed from JFK.

```{r}
ggplot(JFK_flights, aes(x=total_delay)) + 
  geom_histogram()
```

# Question 5
Among the flights with a major delay, defined above (`major_delay`),

- Q5-1. Visualize the relationship between total delay time and flight distance. [Hint: `geom_point`]
```{r}
ggplot(major_delay, aes(x=distance, y=total_delay)) + 
  geom_point() + 
  geom_smooth(method="lm")
```

- Q5-2. Do you agree that the longer the flight, the longer the delay? Argue based on correlation (Use comments to answer).

```{r}
cor(major_delay$distance, major_delay$total_delay)
```

# Question 6
Among the flights with a major delay, defined above,

- Q6-1. Count the number of flights grouped by ("origin", "dest", "carrier") (Hint: use count function).
```{r}
count_flights <- major_delay %>%
  group_by(origin, dest, carrier) %>%
  summarize(freq = n())
```

- Q6-2. Draw the point plots of the number of flights by carrier (i.e., x-axis: carrier and y-axis: number of counts) and change colors by carrier (Hint: `geom_point`).
```{r}
ggplot(count_flights, aes(x=carrier, y=freq, color=carrier)) + 
  geom_point() 
```

- Q6-3. Separate the plots by "origin" (Hint: facet_wrap or facet_grid). 
```{r eval=TRUE}
ggplot(count_flights, aes(x=carrier, y=freq, aes(color=carrier))) + 
  geom_point() +
  labs(title="Question 6", x="Carrier for Each Origin Airport", y="Number of major delays") + 
  facet_wrap(.~origin)
```

- Q6-4. Among the flights that departed from NYC, which carriers and destinations are the worst in terms of frequency of delay for each airport?


